machine:
  environment:
    LC_CTYPE: en_US.UTF-8
  xcode:
    version: "6.3.1"
# dependencies:
#   post:
#     - sudo find /Library/Developer/CoreSimulator/Profiles/Runtimes -name dyld_sim -print0 | xargs -0 sudo chown :wheel
test:
  override:
    - xcodebuild -version
    - set -o pipefail &&
      xcodebuild
        CODE_SIGNING_REQUIRED=NO
        CODE_SIGN_IDENTITY=
        PROVISIONING_PROFILE=
        -workspace KiwiTester.xcworkspace
        -scheme "Kiwi Tester"
        build |
        tee $CIRCLE_ARTIFACTS/xcode-raw-build.log |
      xcpretty --color
    - set -o pipefail &&
      xcodebuild
        CODE_SIGNING_REQUIRED=NO
        CODE_SIGN_IDENTITY=
        PROVISIONING_PROFILE=
        -destination "platform=iOS Simulator,OS=latest,name=iPhone 6"
        -workspace KiwiTester.xcworkspace
        -scheme "Kiwi Tester"
        test |
        tee $CIRCLE_ARTIFACTS/xcode-raw-test.log |
      xcpretty --color --report junit --output $CIRCLE_TEST_REPORTS/xcode/results.xml
